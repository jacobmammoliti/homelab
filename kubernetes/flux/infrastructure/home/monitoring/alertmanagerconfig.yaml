---
apiVersion: monitoring.coreos.com/v1alpha1
kind: AlertmanagerConfig
metadata:
  name: slack-config
  namespace: media
  labels:
    alertmanager: config
spec:
  route:
    groupBy: ["job", "alertname"]
    groupWait: 30s
    groupInterval: 5m
    repeatInterval: 1m
    receiver: "slack-receiver"
    routes:
      - receiver: "slack-receiver"
        continue: true
        matchers:
          - name: namespace
            value: media
  receivers:
    - name: "slack-receiver"
      slackConfigs:
        - sendResolved: true
          apiURL:
            name: slack-webhook-url
            key: webhook-url
            optional: false
          channel: "#alerts"
          title: "{{ range .Alerts }}{{ .Annotations.summary }}\n{{ end }}"
          text: "{{ range .Alerts }}{{ .Annotations.description }}\n{{ end }}"
